<!DOCTYPE HTML>
<html>
    <head>
        <title>404</title>
        <link href = "css/main.css" rel = "stylesheet">
        <link href = "https://fonts.googleapis.com/css?family=Coiny|Felipa|Indie+Flower|PT+Sans+Narrow|Staatliches&amp;subset=cyrillic" rel="stylesheet">
        <link href = "https://fonts.googleapis.com/css?family=Chonburi|Indie+Flower|Nanum+Gothic|Srisakdi|ZCOOL+QingKe+HuangYou" rel="stylesheet">
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="https://unpkg.com/ionicons@4.4.4/dist/ionicons.js"></script>
        <script src = "js/main.js"></script>
        <script src = "vue.js"></script>
        <script src = "jshelper/jshelper.js"></script>
    </head>
    <body>
        <div id = "mainInfo">
            <button id = "mainInfo-butt-close" onclick = "changeIsShowedInfo()" title = "Скрыть">
                <ion-icon name="close"></ion-icon>
            </button>
            <div id = "mainInfo-title">404</div>
            <div id = "mainInfo-info">Страница не найдена.</div>
            <div id = "mainInfo-train">Страница не найдена - попробуйте найти цифры от 1 до 404.</div>
        </div>

        <div id = "page">

            <transition name = "transMain">    
                <div id = "main" v-if = 'isMainVisible'>
                    <div class = "num" v-for = "(num,value) in arrData" @click = "init(arrData[value])" :id = "num">{{num}}</div>
                </div>
            </transition>
            
            <transition name = "transFinal">
                <div id = "final" v-if = "isFinalVisible">
                    <a v-if = "isWin" href = "#" @click = "reload()" id = "linkFinal" title = "Начать с начала">Вы победили!</a>
                    <a v-if = "isLose" href = "#" @click = "reload()" id = "linkFinal" title = "Начать с начала">Вы проиграли!</a>
                    <br /><a href = "#" class = "inf" id = "infLink" @click = "changeIsShowed()" title = "Показать доп. информацию">Время игры:{{record}} секунд.</a>
                    <p v-if = "isShowedDopInf && isResults" class = "dopInf">Вы потратили примерно {{record / recordScore}} секунд на каждый ход.</p>
                    <p v-else-if = "!isResults">Дополнительная информация недоступна.</p>
                </div>
            </transition>
        </div>

        <script>

            Array.prototype.remove = function(value) {
                let idx = this.indexOf(value);
                if (idx != -1) {
                    return this.splice(idx, 1);
                }
                return false;
            }

            var record = 0;

            const jsH = new JsHelper();

            const app = new Vue({
                el:"#page",
                data:{
                    arrData:[],
                    score:0,
                    isMainVisible:true,
                    isFinalVisible:false,
                    seconds:0,
                    record:0,
                    countNumbers:25,
                    isWin:false,
                    isLose:false,
                    finishValue:30,
                    isShowedDopInf:false,
                    mainInterval:setInterval(function() {record ++},1000),
                    recordScore:0,
                    isResults:false,
                    isPhone:false,
                    width:window.screen.width,
                    height:window.screen.height,
                },

                created:function(){
                    this.create();
                },

                methods:{

                    create:function(){

                        let valArr = [];
                        

                        for (let i = 1; i < this.countNumbers + 1; i++){
                            let rNum = jsH.getRandNum(1,this.countNumbers);

                            while (valArr.indexOf(rNum) != -1)
                                rNum = jsH.getRandNum(1,this.countNumbers);
                                
                            valArr.push(rNum);
                            this.arrData.push(rNum);
                        }
                    },

                    changeIsShowed:function(){
                        this.isShowedDopInf = !this.isShowedDopInf;
                    },

                    init:function(num){
                        if ((this.score + 1) === num){
                            if (this.countNumbers != this.finishValue){
                                let numIndex = this.arrData.indexOf(num);

                                this.countNumbers ++;
                                const newcountNumbers = this.countNumbers;

                                this.arrData[numIndex] = newcountNumbers;

                                document.getElementById(num).innerText = newcountNumbers;
                                document.getElementById(num).setAttribute('id',newcountNumbers);
                            } else{
                                this.arrData.remove(num);
                            }

                            this.score++;

                            app.createEff()

                            if (this.score === this.finishValue){
                                try{
                                    this.record = record;
                                    this.recordScore = this.score;
                                    this.isWin = true;
                                    this.isMainVisible = false;
                                    setTimeout(function(){
                                        app.isFinalVisible = true;
                                    },800);
                                    this.isResults = true;
                                    // if (this.isPhone){
                                    //     document.getElementById('linkFinal').style.fontSize = getFontSize(true) + '%';
                                    //     document.getElementById('infLink').style.fontSize = getFontSize(false) + '%';
                                    //     document.getElementById('dopInf').style.fontSize = getFontSize(false) + '%';
                                    // }

                                    if (this.recordScore == 0)
                                        throw new Error("Ошибка:вы ни разу не нажали правильно.");

                                }catch(e){
                                    if (e.name == 'SyntaxError'){
                                        console.log(e.message);
                                        this.isResults = false;
                                    }
                                }
                            }
                        } else{
                            try{
                                this.record = record;
                                this.recordScore = this.score;
                                this.isLose = true;
                                this.isMainVisible = false;
                                setTimeout(function(){
                                    app.isFinalVisible = true;
                                },800);
                                // this.isFinalVisible = true;
                                if (this.recordScore == 0)
                                    throw new SyntaxError("Ошибка:вы ни разу не нажали правильно.");
                                this.isResults = true;
                                // if (this.isPhone){
                                //     document.getElementById('linkFinal').style.fontSize = getFontSize(true) + '%';
                                //     document.getElementById('infLink').style.fontSize = getFontSize(false) + '%';
                                //     document.getElementById('dopInf').style.fontSize = getFontSize(false) + '%';
                                // }

                            }catch(e){
                                if (e.name == 'SyntaxError'){
                                    console.log(e.message);
                                    this.isResults = false;
                                }
                            }
                        }
                    },

                    getFontSize(isBig){
                        if (this.width > 1366 && this.height > 768){
                            if (!isBig)
                                return jsH.getRandNum(150,300);
                            else
                                return jsH.getRandNum(340,400);
                        }else if ((this.width < 1366 && this.height < 768) && this.width > 900){
                            if (!isBig)
                                return jsH.getRandNum(120,250);
                            else
                                return jsH.getRandNum(300,340);
                        }else{
                            if (!isBig)
                                return jsH.getRandNum(60,120);
                            else
                                return jsH.getRandNum(100,130);
                        }
                    },

                    createEff:function(){
                        const colours = ['red',
                        'green',
                        'blue',
                        'grey',
                        'orange',
                        'lightblue',
                        'yellow',
                        'black',
                        'brown'];

                        const fonts = ["font-family: 'Coiny', cursive;",
                        "font-family: 'PT Sans Narrow', sans-serif;",
                        "font-family: 'Staatliches', cursive;",
                        "font-family: 'Felipa', cursive;",
                        "font-family: 'Indie Flower', cursive;",
                        "font-family: 'Srisakdi', cursive;",
                        "font-family: 'ZCOOL QingKe HuangYou', cursive;",
                        "font-family: 'Nanum Gothic', sans-serif;",
                        "font-family: 'Chonburi', cursive;",
                        "font-family: 'Indie Flower', cursive;"];

                        const backgroundColor = ['background:url(img/image1.jpg) no-repeat center/cover;',
                        'background:url(img/image2.jpg) no-repeat center/cover;',
                        'background:url(img/image3.jpg) no-repeat center/cover;',
                        'background:url(img/image4.jpg) no-repeat center/cover;',
                        'background:url(img/image5.jpg) no-repeat center/cover;',
                        'background:url(img/image6.jpg) no-repeat center/cover;',
                        'background:url(img/image7.jpg) no-repeat center/cover;',
                        'background:url(img/image8.jpg) no-repeat center/cover;',
                        'background:url(img/image9.jpg) no-repeat center/cover;',
                        'background:url(img/image10.jpg) no-repeat center/cover;',
                        'background:url(img/image11.png) no-repeat center/cover;',
                        'background:url(img/image12.png) no-repeat center/cover;',
                        'background:url(img/gif1.gif) no-repeat center/cover;',
                        'background:url(img/gif2.gif) no-repeat center/cover;',
                        'background:url(img/gif3.gif) no-repeat center/cover;',
                        'background:url(img/gif4.gif) no-repeat center/cover;']
                        
                        for (let i = 0; i < this.arrData.length; i ++){
                            try{
                                const element = document.getElementById(this.arrData[i]);
                                let isImage = jsH.getRandNum(0,20);

                                element.style.cssText = jsH.getRandFromArr(fonts);

                                if (isImage > 10)
                                    element.style.cssText = jsH.getRandFromArr(backgroundColor) + '-webkit-background-clip:text;-webkit-text-fill-color:transparent;';
                                else
                                    element.style.color = jsH.getRandFromArr(colours);

                                element.style.fontSize = this.getFontSize(false) + '%';
                                if (jsH.getRandNum(0,10) === 1)
                                    element.style.fontSize = this.getFontSize(true) + '%';

                                element.style.marginLeft = jsH.getRandNum(25,50) + "px";
                                element.style.marginRight = jsH.getRandNum(25,50) + "px";
                            }catch(e){
                                console.log("Ошибка:" + e.name + e.message);
                            }

                        }
                        
                    },
                    reload:function(){
                        this.arrData = [];
                        this.score = 0;
                        this.isMainVisible = true;
                        this.isFinalVisible = false;
                        this.seconds = 0;
                        this.record = 0;
                        this.isWin = false;
                        this.isLose = false;
                        this.isShowedDopInf = false;
                        this.countNumbers = 25;
                        this.finishValue = 30;

                        this.create();

                        record = 0;
                        clearInterval(this.mainInterval);

                        this.mainInterval = setInterval(function() {record ++;},1000);

                        setTimeout(function(){
                            app.createEff();
                        },10);
                    }
                }
            });
            
            app.createEff();
        </script>
    </body>
</html>